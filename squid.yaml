manifestVersion: subsquid.io/v0.1
name: joystream-orion
version: 1
description: |-
  Joystream Orion v2 backend

build: 

deploy:
  addons:
    postgres: 
  secrets:
    - OPERATOR_SECRET
  migrate:
    env:
      SUPPORT_NO_CATEGORY_VIDEOS: true
      SUPPORT_NEW_CATEGORIES: true
      KILL_SWITCH_ON: false
    cmd: [ "npx", "squid-typeorm-migration", "apply" ]
  processor:
    env:
      ARCHIVE_GATEWAY_URL: https://joystream.archive.subsquid.io/graphql
      PROCESSOR_PROMETHEUS_PORT: 3000
      SQD_DEBUG: sqd:processor:mapping
      SUPPORT_NO_CATEGORY_VIDEOS: true
      SUPPORT_NEW_CATEGORIES: true
      KILL_SWITCH_ON: false
    cmd: [ "npm", "run", "processor-start" ]
  api:
    env:
      PROCESSOR_HOST: processor
      PROCESSOR_PROMETHEUS_PORT: 3000
      SUPPORT_NO_CATEGORY_VIDEOS: true
      SUPPORT_NEW_CATEGORIES: true
      KILL_SWITCH_ON: false
    cmd: [ "npm", "run", "query-node-start" ]